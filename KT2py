from selenium import webdriver
from selenium.webdriver.common.by import By

driver = webdriver.Chrome()
driver.maximize_window()
driver.get("http://books.toscrape.com/index.html")

books = []
found_thirst = False
thirst_url = None

for page in range(1, 6):
    print(f"Парсим страницу {page}...")
    
    articles = driver.find_elements(By.CSS_SELECTOR, "article.product_pod")
    
    for article in articles:
        title = article.find_element(By.CSS_SELECTOR, "h3 a").get_attribute("title")
        price = article.find_element(By.CSS_SELECTOR, ".price_color").text
        stock = article.find_element(By.CSS_SELECTOR, ".availability").text.strip()
        
        books.append({
            "title": title,
            "price": price,
            "stock": stock
        })
        
        if title == "Thirst":
            found_thirst = True
            thirst_url = article.find_element(By.CSS_SELECTOR, "h3 a").get_attribute("href")
    
    print(f"Собрано {len(articles)} книг")
    if page < 5:
        next_btn = driver.find_element(By.CSS_SELECTOR, "li.next a")
        next_btn.click()

import json
with open("books.json", "w", encoding="utf-8") as f:
    json.dump(books, f, ensure_ascii=False, indent=2)

if found_thirst:
    driver.get(thirst_url)
    driver.save_screenshot("thirst_book.png")
    print('Скриншот книги "Thirst" сохранён.')
else:
    print('Книга "Thirst" не найдена.')

driver.quit()
